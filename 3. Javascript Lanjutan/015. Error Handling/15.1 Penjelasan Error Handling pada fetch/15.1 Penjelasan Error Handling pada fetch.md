# 🚀 Error Handling pada JavaScript & Fetch API

> **Panduan lengkap untuk menangani error dalam JavaScript menggunakan Promise, Async/Await, dan Fetch API**

## 📋 Daftar Isi

- [🎯 Pengenalan](#-pengenalan)
- [🔄 Error Handling dengan Promise](#-error-handling-dengan-promise)
- [⚡ Error Handling dengan Async/Await](#-error-handling-dengan-asyncawait)
- [🌐 Error Handling pada Fetch API](#-error-handling-pada-fetch-api)
  - [Menangani Network Error](#menangani-network-error)
  - [Menangani Response Error](#menangani-response-error)
  - [Menangani API Error](#menangani-api-error)
- [💻 Implementasi Lengkap Movie App](#-implementasi-lengkap-movie-app)
- [🎨 HTML Template](#-html-template)
- [📝 Kesimpulan](#-kesimpulan)

---

## 🎯 Pengenalan

Error handling adalah teknik penting dalam JavaScript untuk menangani kesalahan yang mungkin terjadi saat menjalankan kode. Dengan error handling yang baik, aplikasi akan lebih stabil dan user-friendly.

---

## 🔄 Error Handling dengan Promise

Promise memiliki dua method utama untuk menangani hasil operasi asynchronous:

- **`.then()`** → Menangani ketika Promise berhasil (resolve)
- **`.catch()`** → Menangani ketika Promise gagal (reject)

### 📝 Contoh Kode:

```javascript
const cobaPromise = () => {
  return new Promise((resolve, reject) => {
    const waktu = 3000;
    if (waktu < 5000) {
      setTimeout(() => {
        resolve('selesai');
      }, waktu);
    } else {
      reject('kelamaan');
    }
  });
};

const coba = cobaPromise();
coba
  .then(() => console.log(coba))
  .catch(() => console.log(coba));
```

### 📤 Output:
```
Promise { <fulfilled>: 'selesai' }
```

> **Penjelasan**: Karena waktu (3000ms) kurang dari 5000ms, Promise akan resolve dengan nilai 'selesai' setelah 3 detik.

---

## ⚡ Error Handling dengan Async/Await

Async/Await memberikan sintaks yang lebih bersih untuk menangani Promise:

- **`try`** → Menangani ketika operasi berhasil (resolve)
- **`catch`** → Menangani ketika operasi gagal (reject)

### 📝 Contoh Kode:

```javascript
const cobaPromise = () => {
  return new Promise((resolve, reject) => {
    const waktu = 3000;
    if (waktu < 5000) {
      setTimeout(() => {
        resolve('selesai');
      }, waktu);
    } else {
      reject('kelamaan');
    }
  });
};

const cobaAsync = async () => {
  try {
    const coba = await cobaPromise();
    console.log(coba);
  } catch (error) {
    console.error(error);
  }
};

cobaAsync();
```

### 📤 Output:
```
selesai
```

> **Penjelasan**: Fungsi async menunggu Promise selesai dan mencetak nilai 'selesai' setelah 3 detik.

---

## 🌐 Error Handling pada Fetch API

Fetch API memiliki karakteristik khusus dalam error handling. Fetch hanya akan reject jika terjadi **network error**, bukan HTTP error (seperti 404, 500, dll).

### Menangani Network Error

```javascript
searchButton.addEventListener('click', async function () {
  try {
    const inputKeyword = document.querySelector('.input-keyword');
    const movies = await getMovies(inputKeyword.value);
    console.log(movies);
    updateUI(movies);
  } catch (error) {
    console.log(error);
  }
});
```

### 📤 Output (jika network error):
```
TypeError: Failed to fetch
```

### Menangani Response Error

Untuk menangani HTTP error, kita perlu mengecek `response.ok`:

```javascript
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => {
      console.log(response);
      // Cek response object
    })
    .then((response) => response.Search);
}
```

### 📤 Output (response berhasil):
```javascript
Response {
  status: 200,
  statusText: 'OK',
  ok: true,
  // ... properties lainnya
}
```

### 📤 Output (response error):
```javascript
Response {
  status: 401,
  statusText: 'Unauthorized',
  ok: false,
  // ... properties lainnya
}
```

### Implementasi Pengecekan Response:

```javascript
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => {
      if (!response.ok) {
        throw new Error(response.statusText);
      }
      return response.json();
    })
    .then((response) => response.Search);
}
```

### 📤 Output (jika API key salah):
```
Error: Unauthorized
```

### Menangani API Error

API OMDB mengembalikan response dengan struktur khusus saat terjadi error:

```javascript
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => {
      if (!response.ok) {
        throw new Error(response.statusText);
      }
      return response.json();
    })
    .then((response) => {
      console.log(response);
      // Cek struktur response
    });
}
```

### 📤 Output (input kosong):
```javascript
{
  Response: "False",
  Error: "Incorrect IMDB ID"
}
```

### 📤 Output (film tidak ditemukan):
```javascript
{
  Response: "False",
  Error: "Movie not found!"
}
```

### Implementasi Pengecekan API Error:

```javascript
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => {
      if (!response.ok) {
        throw new Error(response.statusText);
      }
      return response.json();
    })
    .then((response) => {
      if (response.Response === 'False') {
        throw new Error(response.Error);
      }
      return response.Search;
    });
}
```

### Menampilkan Error ke User:

```javascript
searchButton.addEventListener('click', async function () {
  try {
    const inputKeyword = document.querySelector('.input-keyword');
    const movies = await getMovies(inputKeyword.value);
    console.log(movies);
    updateUI(movies);
  } catch (error) {
    alert(error);
  }
});
```

### 📤 Output (alert untuk input kosong):
```
⚠️ Alert: Incorrect IMDB ID
```

### 📤 Output (alert untuk film tidak ditemukan):
```
⚠️ Alert: Movie not found!
```

---

## 💻 Implementasi Lengkap Movie App

### 📝 Kode JavaScript Lengkap:

```javascript
const searchButton = document.querySelector('.search-button');

searchButton.addEventListener('click', async function () {
  try {
    const inputKeyword = document.querySelector('.input-keyword');
    const movies = await getMovies(inputKeyword.value);
    console.log(movies);
    updateUI(movies);
  } catch (error) {
    alert(error);
  }
});

// Mengambil data movie
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => {
      if (!response.ok) {
        throw new Error(response.statusText);
      }
      return response.json();
    })
    .then((response) => {
      if (response.Response === 'False') {
        throw new Error(response.Error);
      }
      return response.Search;
    });
}

// Mengupdate UI
function updateUI(movies) {
  let cards = '';
  movies.forEach((m) => (cards += showCards(m)));
  
  const movieContainer = document.querySelector('.movie-container');
  movieContainer.innerHTML = cards;
}

// Event binding untuk modal
document.addEventListener('click', async function (e) {
  if (e.target.classList.contains('modal-detail-button')) {
    const imdbid = e.target.dataset.imdbid;
    const movieDetail = await getMovieDetail(imdbid);
    updateUIDetail(movieDetail);
  }
});

// Mengambil data detail movie
function getMovieDetail(imdbid) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&i=' + imdbid)
    .then((response) => response.json())
    .then((m) => m);
}

// Mengupdate UI detail movie
function updateUIDetail(m) {
  const movieDetail = showMovieDetail(m);
  const modalBody = document.querySelector('.modal-body');
  modalBody.innerHTML = movieDetail;
}

// Template card movie
function showCards(m) {
  return `<div class="col-md-4 my-5">
              <div class="card">
                <img src="${m.Poster}" class="card-img-top" />
                <div class="card-body">
                  <h5 class="card-title">${m.Title}</h5>
                  <h6 class="card-subtitle mb-2 text-body-secondary">${m.Year}</h6>
                  <a href="#" class="btn btn-primary modal-detail-button" 
                     data-bs-toggle="modal" data-bs-target="#movieDetailModal" 
                     data-imdbid="${m.imdbID}">Show Details</a>
                </div>
              </div>
            </div>`;
}

// Template detail movie
function showMovieDetail(m) {
  return `<div class="container-fluid">
              <div class="row">
                <div class="col-md-3">
                  <img src="${m.Poster}" alt="" class="img-fluid" />
                </div>
                <div class="col-md">
                  <ul class="list-group">
                    <li class="list-group-item"><h4>${m.Title} (${m.Year})</h4></li>
                    <li class="list-group-item">
                      <strong>Director :</strong> ${m.Director}
                    </li>
                    <li class="list-group-item">
                      <strong>Actors :</strong> ${m.Actors}
                    </li>
                    <li class="list-group-item">
                      <strong>Writer :</strong> ${m.Writer}
                    </li>
                    <li class="list-group-item">
                      <strong>Plot :</strong><br/>
                      ${m.Plot}
                    </li>
                  </ul>
                </div>
              </div>
            </div>`;
}
```

---

## 🎨 HTML Template

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Handling Error</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container">
      <div class="row mt-5">
        <div class="col">
          <h1>🎬 Ahmad Movie DB</h1>
        </div>
      </div>

      <div class="row">
        <div class="col-md-8">
          <div class="input-group mb-3">
            <input
              type="text"
              class="form-control input-keyword"
              placeholder="Search Movie ..."
            />
            <button
              class="btn btn-primary search-button"
              type="button"
            >
              Search
            </button>
          </div>
        </div>
      </div>

      <div class="row movie-container"></div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="movieDetailModal">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5">Movie Detail</h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="./script.js"></script>
  </body>
</html>
```

---

## 📝 Kesimpulan

### 🎯 Poin Penting Error Handling:

1. **Promise**: Gunakan `.then()` untuk success dan `.catch()` untuk error
2. **Async/Await**: Gunakan `try` untuk success dan `catch` untuk error
3. **Fetch API**: Hanya reject pada network error, bukan HTTP error
4. **Response Check**: Selalu cek `response.ok` untuk HTTP error
5. **API Error**: Periksa struktur response API untuk error handling yang lebih spesifik

### ✅ Best Practices:

- Selalu gunakan error handling pada operasi asynchronous
- Berikan feedback yang jelas kepada user saat terjadi error
- Periksa berbagai jenis error (network, HTTP, API)
- Gunakan pesan error yang informatif dan mudah dipahami

### 🚀 Next Steps:

- Implementasikan loading indicator
- Tambahkan validasi input yang lebih robust
- Gunakan toast notification sebagai alternatif alert
- Implementasikan retry mechanism untuk failed requests

---

> **💡 Tips**: Error handling yang baik membuat aplikasi lebih professional dan user-friendly. Jangan lupa untuk selalu test berbagai skenario error!
