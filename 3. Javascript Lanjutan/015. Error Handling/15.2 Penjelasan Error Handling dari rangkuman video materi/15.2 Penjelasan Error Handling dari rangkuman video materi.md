# üö® Error Handling JavaScript dengan Fetch API

> **Panduan lengkap menangani error dalam JavaScript dengan implementasi pada Movie Search App menggunakan OMDB API**

---

## üìã Daftar Isi

- [üö® Error Handling JavaScript dengan Fetch API](#-error-handling-javascript-dengan-fetch-api)
  - [üìã Daftar Isi](#-daftar-isi)
  - [üéØ Overview](#-overview)
  - [üìö Konsep Dasar Error Handling](#-konsep-dasar-error-handling)
    - [üîÑ Error Handling dengan Promise](#-error-handling-dengan-promise)
    - [‚ö° Error Handling dengan Async/Await](#-error-handling-dengan-asyncawait)
  - [üîç Problem yang Dihadapi](#-problem-yang-dihadapi)
  - [üìù Langkah-Langkah Implementation](#-langkah-langkah-implementation)
    - [1Ô∏è‚É£ Basic Error Handling dengan Try/Catch](#1Ô∏è‚É£-basic-error-handling-dengan-trycatch)
    - [2Ô∏è‚É£ Memahami Batasan Catch pada Fetch](#2Ô∏è‚É£-memahami-batasan-catch-pada-fetch)
    - [3Ô∏è‚É£ Investigasi Response Object](#3Ô∏è‚É£-investigasi-response-object)
    - [4Ô∏è‚É£ Implementasi Pengecekan response.ok (Attempt 1)](#4Ô∏è‚É£-implementasi-pengecekan-responseok-attempt-1)
    - [5Ô∏è‚É£ Perbaikan Error Handling HTTP](#5Ô∏è‚É£-perbaikan-error-handling-http)
    - [6Ô∏è‚É£ Investigasi Error API Spesifik](#6Ô∏è‚É£-investigasi-error-api-spesifik)
    - [7Ô∏è‚É£ Implementasi Error Handling API Response](#7Ô∏è‚É£-implementasi-error-handling-api-response)
    - [8Ô∏è‚É£ Error Display ke User](#8Ô∏è‚É£-error-display-ke-user)
  - [üèÅ Code Final Lengkap](#-code-final-lengkap)
  - [‚úÖ Tingkatan Error Handling yang Tercapai](#-tingkatan-error-handling-yang-tercapai)
  - [üîß Cara Menjalankan Project](#-cara-menjalankan-project)

---

## üéØ Overview

Dokumentasi ini membahas cara menangani error dalam JavaScript, khususnya saat menggunakan Fetch API untuk mengambil data dari server. Kita akan belajar bagaimana menangani berbagai jenis error mulai dari network error, HTTP status error, hingga API-specific error menggunakan aplikasi pencarian film sebagai studi kasus.

---

## üìö Konsep Dasar Error Handling

### üîÑ Error Handling dengan Promise

Promise menggunakan `.then()` untuk menangani resolve (berhasil) dan `.catch()` untuk menangani reject (gagal).

```javascript
// Error Handling : Promise 
// .then() -> jika resolve (berhasil)
// .catch() -> jika reject (gagal)

const cobaPromise = () => {
  return new Promise((resolve, reject) => {
    const waktu = 3000;
    if (waktu < 5000) {
      setTimeout(() => {
        resolve('selesai');
      }, waktu);
    } else {
      reject('kelamaan');
    }
  });
};

const coba = cobaPromise();
coba.then(() => console.log(coba)).catch(() => console.log(coba));
```

**Output:**
```
Promise {<fulfilled>: 'selesai'}
```

### ‚ö° Error Handling dengan Async/Await

Async/Await menggunakan `try` untuk menangani resolve (berhasil) dan `catch()` untuk menangani reject (gagal).

```javascript
// Error Handling : Async Await
// try -> jika resolve (berhasil)
// catch() -> jika reject (gagal)

const cobaPromise = () => {
  return new Promise((resolve, reject) => {
    const waktu = 3000;
    if (waktu < 5000) {
      setTimeout(() => {
        resolve('selesai');
      }, waktu);
    } else {
      reject('kelamaan');
    }
  });
};

const cobaAsync = async () => {
  try {
    const coba = await cobaPromise();
    console.log(coba);
  } catch (error) {
    console.error(error);
  }
};

cobaAsync();
```

**Output:**
```
selesai
```

---

## üîç Problem yang Dihadapi

**‚ùì Gimana handling error pada fetch() ?**

Karena fetch() adalah API dari JavaScript yang kita tidak tahu apa yang ada di dalam method reject dari fetch(), jadi kita akan mencoba handling error pada fetch.

**üö´ Masalah yang terjadi:**
- Pada code sebelumnya hanya menangani saat berhasil saja
- Jika kita mengetik nama sembarang pada kolom pencarian movie, errornya akan muncul di browser
- Error tidak tertangani dengan baik

---

## üìù Langkah-Langkah Implementation

### 1Ô∏è‚É£ Basic Error Handling dengan Try/Catch

**Code awal tanpa error handling:**
```javascript
searcButton.addEventListener('click', function () {
  const inputKeyword = document.querySelector('.input-keyword');
  const movies = getMovies(inputKeyword.value);
  console.log(movies);
  updateUI(movies);
});
```

**‚û°Ô∏è Implementasi try/catch:**
```javascript
searcButton.addEventListener('click', async function () {
  try {
    const inputKeyword = document.querySelector('.input-keyword');
    const movies = await getMovies(inputKeyword.value);
    console.log(movies);
    updateUI(movies);
  } catch (error) {
    console.log(error);
  }
});
```

**Output:**
```
‚úÖ Error sudah ditangkap oleh catch(), tidak lagi ditangkap oleh browser
```

---

### 2Ô∏è‚É£ Memahami Batasan Catch pada Fetch

**üß™ Test case:** Apa saja yang bisa ditangkap oleh catch()?

**Contoh - URL salah:**
```javascript
// Misal urlnya salah
fetch('http://www.salahurl.com/?apikey=b2a155c4&s=batman')
```

**Output:**
```
TypeError: Failed to fetch
```

**üìã Kesimpulan penting:**
- Error pada fetch, yang ditangkap hanya error pada networknya
- Misal saat kita mengosongkan movie saat diklik maupun menulis sembarang nama movie, errornya dari browser (karena ada fungsi updateUI, kalau dinon aktifkan dulu, errornya tidak muncul)
- **catch() pada fetch hanya menangkap saat error pada networknya saja**

---

### 3Ô∏è‚É£ Investigasi Response Object

**‚ùó Problem:** Untuk menangani hal itu, kita harus tangani manual pada saat fetchnya berhasil mengambil data dari API. Misal kita membuat kesalahan pada key maka hasilnya sebagai berikut.

**Code investigasi:**
```javascript
// mengambil movie
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => {
      console.log(response); // Ubah code untuk melihat dari response apa saja yang muncul 
    })
    .then((response) => response.Search);
}
```

**üìä Hasil pengamatan:**

**Kondisi 1 - Input kosong, key dan url benar:**
```javascript
Response {
  status: 200,
  ok: true,
  // ... other properties
}
```

**Kondisi 2 - Key dan URL benar:**
```
ok: true
```

**Kondisi 3 - Key salah:**
```
ok: false
```

**‚ú® Kesimpulan:** Jadi kita bisa mengambil `response.ok`, `response.status`, `response.statusText`

---

### 4Ô∏è‚É£ Implementasi Pengecekan response.ok (Attempt 1)

```javascript
// mengambil movie
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=2a155c4&s=' + keyword)  // Key sengaja salah
    .then((response) => {
      if (!response.ok) {
        throw Error(response.status);
      }
    })
    .then((response) => response.Search);
}
```

**Output:**
```
Error: 401
```

---

### 5Ô∏è‚É£ Perbaikan Error Handling HTTP

```javascript
// mengambil movie
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => {
      if (!response.ok) {
        throw new Error(response.statusText);
      }
      return response.json();
    })
    .then((response) => response.Search);
}
```

**üîç Penjelasan detail:**
```javascript
// jika response.ok bernilai false (! berarti NOT, nilai awal dari ok adalah true)
if (!response.ok) {
// keyword throw -> untuk mengalihkan error ke class Error punya dari javascript
// new Error -> untuk bisa mengakses class Error dari javascript dan errornya berisi response.statusText
        throw Error(response.statusText);
      }

// jika sudah dicek keynya sudah benar, maka return hasil dari response yang sudah diberi method json()
      return response.json();
```

**Output:**
```
Error: Unauthorized (jika key salah)
‚úÖ Data berhasil diambil (jika key benar)
```

---

### 6Ô∏è‚É£ Investigasi Error API Spesifik

**‚ùó Problem:** Selanjutnya menangani error saat hanya memasukkan nilai kosong atau nama movie sembarang saat mengklik tombol search.

**Code investigasi:**
```javascript
// mengambil movie
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => {
      if (!response.ok) {
        throw new Error(response.statusText);
      }
      return response.json();
    })
    .then((response) => {
      console.log(response); // untuk melihat dulu apa saja respon yang ditunjukkan 
    });
}
```

**üìä Hasil pengamatan:**

**Kondisi 1 - Input kosong:**
```javascript
{
  Response: "False",
  Error: "Incorrect IMDb ID."
}
```

**Kondisi 2 - Menulis sembarang judul:**
```javascript
{
  Response: "False", 
  Error: "Movie not found!"
}
```

---

### 7Ô∏è‚É£ Implementasi Error Handling API Response

```javascript
// mengambil movie
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => {
      if (!response.ok) {
        throw new Error(response.statusText);
      }
      return response.json();
    })
    .then((response) => {
      if (response.Response === 'False') {
        throw new Error(response.Error);
      }
      return response.Search;
    });
}
```

**üîç Penjelasan detail:**
```javascript
// jika berhasil lolos dari pengecekan key maka dilanjutkan proses pengecekan kosong atau tidak sesuainya inputan movie sebelum klik tombol search
.then((response) => {
// jika response.Response bernilai false
      if (response.Response === 'False') {
// maka di lempar ke class Error milik javascript yang berisi nilai dari response.Error
        throw new Error(response.Error);
      }

// jika sudah lolos pengecekan baru di return hasilnya 
      return response.Search;
    })
```

**Output:**
```
Error: Incorrect IMDb ID. (jika input kosong)
Error: Movie not found! (jika movie tidak ditemukan)
‚úÖ Array of movies (jika berhasil)
```

---

### 8Ô∏è‚É£ Error Display ke User

**‚ùó Problem:** Code diatas hanya kelihatan di console, misal ingin errornya nampak di browser bisa memanfaatkan alert, seperti code di bawah.

```javascript
searcButton.addEventListener('click', async function () {
  try {
    const inputKeyword = document.querySelector('.input-keyword');
    const movies = await getMovies(inputKeyword.value);
    console.log(movies);
    updateUI(movies);
  } catch (error) {
    alert(error);
  }
});
```

**üîç Penjelasan:**
```javascript
// catch berisi parameter error yang ditangkap
catch (error) {
// agar errornya kelihatan di browser berbentuk alert yang menunjukkan pesannya
    alert(error);
  }
```

**üì± Hasil akhir:**

**Test 1 - Input kosong mengklik tombol search:**
```
Alert popup: "Error: Incorrect IMDb ID."
```

**Test 2 - Menulis movie sembarangan:**
```
Alert popup: "Error: Movie not found!"
```

---

## üèÅ Code Final Lengkap

```javascript
const searcButton = document.querySelector('.search-button');

searcButton.addEventListener('click', async function () {
  try {
    const inputKeyword = document.querySelector('.input-keyword');
    const movies = await getMovies(inputKeyword.value);
    console.log(movies);
    updateUI(movies);
  } catch (error) {
    alert(error);
  }
});

// mengambil movie
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => {
      if (!response.ok) {
        throw new Error(response.statusText);
      }
      return response.json();
    })
    .then((response) => {
      if (response.Response === 'False') {
        throw new Error(response.Error);
      }
      return response.Search;
    });
}

// mengupdate UI
function updateUI(movies) {
  let cards = '';
  movies.forEach((m) => (cards += showCards(m)));
  const movieContainer = document.querySelector('.movie-container');
  movieContainer.innerHTML = cards;
}

// event binding
document.addEventListener('click', async function (e) {
  if (e.target.classList.contains('modal-detail-button')) {
    const imdbid = e.target.dataset.imdbid;
    const movieDetail = await getMoviedetail(imdbid);
    updateUIDetail(movieDetail);
  }
});

// mengambil data detail movie
function getMoviedetail(imdbid) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&i=' + imdbid)
    .then((response) => response.json())
    .then((m) => m);
}

// mengupdate ui detail movie
function updateUIDetail(m) {
  const movieDetail = showMovieDetail(m);
  const modalBody = document.querySelector('.modal-body');
  modalBody.innerHTML = movieDetail;
}

// menampung cards
function showCards(m) {
  return `<div class="col-md-4 my-5">
              <div class="card">
                <img src="${m.Poster}" class="card-img-top" />
                <div class="card-body">
                  <h5 class="card-title">${m.Title}</h5>
                  <h6 class="card-subtitle mb-2 text-body-secondary">${m.Year}</h6>
                  <a href="#" class="btn btn-primary modal-detail-button" data-bs-toggle="modal" data-bs-target="#movieDetailModal" data-imdbid="${m.imdbID}">Show Details</a>
                </div>
              </div>
            </div>`;
}

// menampung movie detail
function showMovieDetail(m) {
  return `<div class="container-fluid">
              <div class="row">
                <div class="col-md-3">
                  <img src="${m.Poster}" alt="" class="img-fluid" />
                </div>
                <div class="col-md">
                  <ul class="list-group">
                    <li class="list-group-item"><h4>${m.Title} (${m.Year})</h4></li>
                    <li class="list-group-item">
                      <strong>Director : </strong> ${m.Director}
                    </li>
                    <li class="list-group-item">
                      <strong>Actors : </strong> ${m.Actors}
                    </li>
                    <li class="list-group-item">
                      <strong>Writer : </strong> ${m.Writer}
                    </li>
                    <li class="list-group-item">
                      <strong>Plot : </strong> <br />
                    ${m.Plot}
                    </li>
                  </ul>
                </div>
              </div>
            </div>`;
}
```

---

## ‚úÖ Tingkatan Error Handling yang Tercapai

| Level | Jenis Error | Cara Penanganan | Status |
|-------|-------------|-----------------|---------|
| 1Ô∏è‚É£ | **Network Error** | Ditangkap otomatis oleh `catch()` | ‚úÖ |
| 2Ô∏è‚É£ | **HTTP Status Error** | Dicek manual dengan `response.ok` | ‚úÖ |
| 3Ô∏è‚É£ | **API Specific Error** | Dicek manual dengan `response.Response === 'False'` | ‚úÖ |

**üéØ Hasil Akhir:**
- ‚úÖ Network error tertangani
- ‚úÖ HTTP status error tertangani  
- ‚úÖ API specific error tertangani
- ‚úÖ User mendapat feedback yang jelas
- ‚úÖ Aplikasi tidak crash

---

## üîß Cara Menjalankan Project

1. **Clone/Download** project ini
2. **Buat file HTML** dengan struktur yang sesuai
3. **Include Bootstrap** untuk styling
4. **Masukkan JavaScript** ke dalam file terpisah
5. **Buka di browser** dan test berbagai skenario error

**üîó API yang digunakan:** [OMDB API](http://www.omdbapi.com/)

---

> üí° **Tips:** Selalu tangani error dengan baik untuk memberikan user experience yang optimal dan mencegah aplikasi crash!

---

**üìù Dokumentasi ini dibuat untuk pembelajaran Error Handling JavaScript dengan implementasi nyata pada aplikasi Movie Search.**
