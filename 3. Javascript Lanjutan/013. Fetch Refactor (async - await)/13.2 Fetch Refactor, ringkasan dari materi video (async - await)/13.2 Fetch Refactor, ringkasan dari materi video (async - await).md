# ğŸ¬ Refactoring JavaScript: Dari Fetch API ke Async/Await

> Tutorial lengkap refactoring kode JavaScript untuk Movie Database menggunakan OMDB API

[![JavaScript](https://img.shields.io/badge/JavaScript-ES6+-yellow.svg)](https://developer.mozilla.org/en-US/docs/Web/JavaScript)
[![Bootstrap](https://img.shields.io/badge/Bootstrap-5.3.3-purple.svg)](https://getbootstrap.com/)
[![API](https://img.shields.io/badge/API-OMDB-blue.svg)](http://www.omdbapi.com/)

---

## ğŸ“‹ Daftar Isi

- [ğŸ¯ Overview](#overview)
- [ğŸ—ï¸ Struktur Project](#struktur-project)
- [ğŸ”§ Kode Awal (Sebelum Refactoring)](#kode-awal-sebelum-refactoring)
- [âš¡ Langkah-langkah Refactoring Detail](#langkah-langkah-refactoring-detail)
  - [Langkah 1: Persiapan Refactoring](#langkah-1-persiapan-refactoring)
  - [Langkah 2: Membuat Event Listener Dasar](#langkah-2-membuat-event-listener-dasar)
  - [Langkah 3: Mengambil Input Value](#langkah-3-mengambil-input-value)
  - [Langkah 4: Abstraksi Fetch dengan Function](#langkah-4-abstraksi-fetch-dengan-function)
  - [Langkah 5: Membuat Function getMovies()](#langkah-5-membuat-function-getmovies)
  - [Langkah 6: Mengatasi Promise Pending](#langkah-6-mengatasi-promise-pending)
  - [Langkah 7: Implementasi Async/Await](#langkah-7-implementasi-asyncawait)
  - [Langkah 8: Membuat Function updateUI()](#langkah-8-membuat-function-updateui)
  - [Langkah 9: Mengatasi Modal Button dengan Event Binding](#langkah-9-mengatasi-modal-button-dengan-event-binding)
  - [Langkah 10: Mengambil IMDB ID](#langkah-10-mengambil-imdb-id)
  - [Langkah 11: Fetch Detail Movie](#langkah-11-fetch-detail-movie)
  - [Langkah 12: Abstraksi Detail Movie](#langkah-12-abstraksi-detail-movie)
  - [Langkah 13: Implementasi Async/Await untuk Detail](#langkah-13-implementasi-asyncawait-untuk-detail)
  - [Langkah 14: Membuat Function updateUIDetail()](#langkah-14-membuat-function-updateuidetail)
- [ğŸ¯ Kode Final (Setelah Refactoring)](#kode-final-setelah-refactoring)
- [ğŸ“Š Perbandingan Before vs After](#perbandingan-before-vs-after)
- [ğŸ“ Kesimpulan](#kesimpulan)

---

## <a id="overview"></a>ğŸ¯ Overview

Dokumentasi ini menjelaskan proses refactoring kode JavaScript yang menggunakan Fetch API untuk mengambil data film dari OMDB API. Refactoring dilakukan untuk:

- âœ… Meningkatkan **readability** kode
- âœ… Memisahkan **concerns** (separation of concerns)
- âœ… Menggunakan **async/await** menggantikan callback chains
- âœ… Menerapkan **event binding** untuk elemen dinamis
- âœ… Membuat struktur kode yang lebih **maintainable**

---

## <a id="struktur-project"></a>ğŸ—ï¸ Struktur Project

```
project/
â”œâ”€â”€ index.html          # Halaman utama
â”œâ”€â”€ index.js  # File JavaScript (hasil refactoring)
â””â”€â”€ README.md           # Dokumentasi ini
```

**File HTML:**
- Bootstrap 5.3.3 untuk styling
- Input field untuk pencarian film
- Modal untuk menampilkan detail film
- Container untuk menampilkan hasil pencarian

---

## <a id="kode-awal-sebelum-refactoring"></a>ğŸ”§ Kode Awal (Sebelum Refactoring)

```javascript
// KODE ORIGINAL - MENGGUNAKAN FETCH
const searcButton = document.querySelector('.search-button');

searcButton.addEventListener('click', function () {
  const inputKeyword = document.querySelector('.input-keyword');

  fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + inputKeyword.value)
    .then((response) => response.json())
    .then((response) => {
      const movies = response.Search;
      
      let cards = '';
      movies.forEach((m) => (cards += showCards(m)));
      
      const movieContainer = document.querySelector('.movie-container');
      movieContainer.innerHTML = cards;
      
      const modalDetailButton = document.querySelectorAll('.modal-detail-button');
      
      modalDetailButton.forEach((btn) => {
        btn.addEventListener('click', function () {
          const imdbid = this.dataset.imdbid;
          
          fetch('http://www.omdbapi.com/?apikey=b2a155c4&i=' + imdbid)
            .then((response) => response.json())
            .then((m) => {
              const movieDetail = showMovieDetail(m);
              const modalBody = document.querySelector('.modal-body');
              modalBody.innerHTML = movieDetail;
            });
        });
      });
    });
});
```

**âŒ Masalah pada kode awal:**
- Nested callbacks yang sulit dibaca
- Logika tercampur dalam satu tempat
- Sulit untuk di-maintain dan debug
- Event listener modal tidak berfungsi untuk elemen dinamis

---

## <a id="langkah-langkah-refactoring-detail"></a>âš¡ Langkah-langkah Refactoring Detail

### <a id="langkah-1-persiapan-refactoring"></a>Langkah 1: Persiapan Refactoring

**ğŸ¯ Tujuan:** Menghapus kode fetch dan menyiapkan function yang akan tetap digunakan

```javascript
// âœ… Function yang TIDAK dihapus - masih dibutuhkan
function showCards(m) {
  return `<div class="col-md-4 my-5">
            <div class="card">
              <img src="${m.Poster}" class="card-img-top" />
              <div class="card-body">
                <h5 class="card-title">${m.Title}</h5>
                <h6 class="card-subtitle mb-2 text-body-secondary">${m.Year}</h6>
                <a href="#" class="btn btn-primary modal-detail-button" 
                   data-bs-toggle="modal" data-bs-target="#movieDetailModal" 
                   data-imdbid="${m.imdbID}">Show Details</a>
              </div>
            </div>
          </div>`;
}

function showMovieDetail(m) {
  return `<div class="container-fluid">
            <div class="row">
              <div class="col-md-3">
                <img src="${m.Poster}" alt="" class="img-fluid" />
              </div>
              <div class="col-md">
                <ul class="list-group">
                  <li class="list-group-item"><h4>${m.Title} (${m.Year})</h4></li>
                  <li class="list-group-item"><strong>Director:</strong> ${m.Director}</li>
                  <li class="list-group-item"><strong>Actors:</strong> ${m.Actors}</li>
                  <li class="list-group-item"><strong>Writer:</strong> ${m.Writer}</li>
                  <li class="list-group-item"><strong>Plot:</strong><br/>${m.Plot}</li>
                </ul>
              </div>
            </div>
          </div>`;
}
```

**ğŸ“¤ Output:** Function helper siap untuk digunakan dalam refactoring

---

### <a id="langkah-2-membuat-event-listener-dasar"></a>Langkah 2: Membuat Event Listener Dasar

**ğŸ¯ Tujuan:** Membuat structure dasar untuk event listener

```javascript
// âœ… Ambil elemen tombol search
const searchButton = document.querySelector('.search-button');

// âœ… Buat event listener kosong
searchButton.addEventListener('click', function () {
  // Kode akan ditambahkan di sini
});
```

**ğŸ“¤ Output:** Event listener dasar berhasil dibuat, siap untuk development selanjutnya

---

### <a id="langkah-3-mengambil-input-value"></a>Langkah 3: Mengambil Input Value

**ğŸ¯ Tujuan:** Mengambil value dari input yang diketik user dan melakukan testing

```javascript
searchButton.addEventListener('click', function () {
  const inputKeyword = document.querySelector('.input-keyword');
  
  // âœ… Testing: tampilkan value yang diketik user
  console.log(inputKeyword.value);
});
```

**ğŸ“¤ Output:** 
```
// Jika user mengetik "avengers"
> avengers

// Jika user mengetik "spider man"  
> spider man
```

---

### <a id="langkah-4-abstraksi-fetch-dengan-function"></a>Langkah 4: Abstraksi Fetch dengan Function

**ğŸ¯ Tujuan:** Memisahkan logic pengambilan data dari event listener

```javascript
searchButton.addEventListener('click', function () {
  const inputKeyword = document.querySelector('.input-keyword');
  
  // âœ… Abstraksi fetch ke dalam function terpisah
  const movies = getMovies(inputKeyword.value);
  
  console.log(movies); // âš ï¸ Akan menghasilkan Promise pending
});
```

**ğŸ“¤ Output:** 
```javascript
> Promise {<pending>}
```

**âŒ Masalah:** Function `getMovies()` belum dibuat, dan hasilnya Promise pending

---

### <a id="langkah-5-membuat-function-getmovies"></a>Langkah 5: Membuat Function getMovies()

**ğŸ¯ Tujuan:** Membuat function untuk mengambil data movies dari API

```javascript
// âŒ Percobaan pertama - masih return pending
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword).then(
    (response) => console.log(response.json())
  );
}
```

**ğŸ“¤ Output:** `Promise {<pending>}`

```javascript
// âœ… Perbaikan - tambahkan return dan chain .then()
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => response.json())
    .then((response) => console.log(response));
}
```

**ğŸ“¤ Output:**
```javascript
{
  Search: [
    {Title: "Avengers: Endgame", Year: "2019", imdbID: "tt4154796", ...},
    {Title: "The Avengers", Year: "2012", imdbID: "tt0848228", ...},
    // ... more movies
  ],
  totalResults: "156",
  Response: "True"
}
```

```javascript
// âœ… Hilangkan console.log dan ambil hanya Search array
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => response.json())
    .then((response) => response.Search);
}
```

**ğŸ“¤ Output:** Function siap mengembalikan array movies

---

### <a id="langkah-6-mengatasi-promise-pending"></a>Langkah 6: Mengatasi Promise Pending

**ğŸ¯ Tujuan:** Mengatasi masalah Promise pending dengan testing

```javascript
searchButton.addEventListener('click', function () {
  const inputKeyword = document.querySelector('.input-keyword');
  
  const movies = getMovies(inputKeyword.value);
  
  console.log(movies); // âŒ Masih Promise {<pending>}
});
```

**ğŸ“¤ Output:**
```javascript
> Promise {<pending>}
```

**âŒ Masalah:** JavaScript membaca kode secara synchronous, sedangkan `getMovies()` adalah asynchronous

---

### <a id="langkah-7-implementasi-asyncawait"></a>Langkah 7: Implementasi Async/Await

**ğŸ¯ Tujuan:** Menggunakan async/await untuk mengatasi Promise pending

```javascript
// âœ… Tambahkan async dan await
searchButton.addEventListener('click', async function () {
  const inputKeyword = document.querySelector('.input-keyword');
  
  const movies = await getMovies(inputKeyword.value);
  
  console.log(movies);
});
```

**ğŸ“¤ Output:**
```javascript
[
  {Title: "Avengers: Endgame", Year: "2019", imdbID: "tt4154796", Type: "movie", Poster: "https://..."},
  {Title: "The Avengers", Year: "2012", imdbID: "tt0848228", Type: "movie", Poster: "https://..."},
  {Title: "Avengers: Infinity War", Year: "2018", imdbID: "tt4154756", Type: "movie", Poster: "https://..."}
  // ... more movies
]
```

**âœ… Berhasil:** Data movies sudah bisa diakses dengan benar!

---

### <a id="langkah-8-membuat-function-updateui"></a>Langkah 8: Membuat Function updateUI()

**ğŸ¯ Tujuan:** Memisahkan logic update UI dari event listener

```javascript
// âœ… Aktifkan updateUI di event listener
searchButton.addEventListener('click', async function () {
  const inputKeyword = document.querySelector('.input-keyword');
  
  const movies = await getMovies(inputKeyword.value);
  
  console.log(movies);
  updateUI(movies); // âœ… Panggil function updateUI
});

// âœ… Buat function updateUI
function updateUI(movies) {
  let cards = '';
  movies.forEach((m) => (cards += showCards(m)));
  
  const movieContainer = document.querySelector('.movie-container');
  movieContainer.innerHTML = cards;
}
```

**ğŸ“¤ Output:** Movie cards berhasil ditampilkan di halaman web

---

### <a id="langkah-9-mengatasi-modal-button-dengan-event-binding"></a>Langkah 9: Mengatasi Modal Button dengan Event Binding

**ğŸ¯ Tujuan:** Mengatasi masalah modal button yang tidak terdeteksi

```javascript
// âŒ Masalah: button detail tidak terdeteksi
const movieDetailBtn = document.querySelector('.modal-detail-button');
console.log(movieDetailBtn); // null
```

**ğŸ“¤ Output:** `null` (karena button belum ada saat halaman pertama load)

```javascript
// âœ… Solusi: gunakan event binding
document.addEventListener('click', function (e) {
  if (e.target.classList.contains('modal-detail-button')) {
    alert('Button detail diklik!');
  }
});
```

**ğŸ“¤ Output:** Alert muncul hanya ketika button modal detail diklik

---

### <a id="langkah-10-mengambil-imdb-id"></a>Langkah 10: Mengambil IMDB ID

**ğŸ¯ Tujuan:** Mengambil IMDB ID dari setiap movie card yang diklik

```javascript
document.addEventListener('click', function (e) {
  if (e.target.classList.contains('modal-detail-button')) {
    const imdbid = e.target.dataset.imdbid;
    
    console.log(imdbid);
  }
});
```

**ğŸ“¤ Output:**
```javascript
// Ketika klik detail "Avengers: Endgame"
> tt4154796

// Ketika klik detail "The Avengers"  
> tt0848228

// Ketika klik detail movie lain
> tt4154756
```

---

### <a id="langkah-11-fetch-detail-movie"></a>Langkah 11: Fetch Detail Movie

**ğŸ¯ Tujuan:** Mengambil detail movie berdasarkan IMDB ID

```javascript
// âŒ Percobaan pertama - masih pending
document.addEventListener('click', function (e) {
  if (e.target.classList.contains('modal-detail-button')) {
    const imdbid = e.target.dataset.imdbid;
    
    fetch('http://www.omdbapi.com/?apikey=b2a155c4&i=' + imdbid).then(
      (response) => console.log(response.json())
    );
  }
});
```

**ğŸ“¤ Output:** `Promise {<pending>}`

```javascript
// âœ… Perbaikan - chain .then() kedua
document.addEventListener('click', function (e) {
  if (e.target.classList.contains('modal-detail-button')) {
    const imdbid = e.target.dataset.imdbid;
    
    fetch('http://www.omdbapi.com/?apikey=b2a155c4&i=' + imdbid)
      .then((response) => response.json())
      .then((response) => console.log(response));
  }
});
```

**ğŸ“¤ Output:**
```javascript
{
  Title: "Avengers: Endgame",
  Year: "2019",
  Director: "Anthony Russo, Joe Russo",
  Actors: "Robert Downey Jr., Chris Evans, Mark Ruffalo",
  Plot: "After the devastating events of Avengers: Infinity War...",
  Poster: "https://m.media-amazon.com/images/...",
  // ... detail lengkap movie
}
```

---

### <a id="langkah-12-abstraksi-detail-movie"></a>Langkah 12: Abstraksi Detail Movie

**ğŸ¯ Tujuan:** Memisahkan logic pengambilan detail movie ke function terpisah

```javascript
// âœ… Abstraksi ke function getMovieDetail
document.addEventListener('click', function (e) {
  if (e.target.classList.contains('modal-detail-button')) {
    const imdbid = e.target.dataset.imdbid;
    
    const movieDetail = getMovieDetail(imdbid);
    
    console.log(movieDetail); // âŒ Promise {<pending>}
  }
});

// âœ… Buat function getMovieDetail
function getMovieDetail(imdbid) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&i=' + imdbid)
    .then((response) => response.json())
    .then((m) => m);
}
```

**ğŸ“¤ Output:** `Promise {<pending>}` (masih perlu async/await)

---

### <a id="langkah-13-implementasi-asyncawait-untuk-detail"></a>Langkah 13: Implementasi Async/Await untuk Detail

**ğŸ¯ Tujuan:** Menggunakan async/await untuk detail movie

```javascript
// âœ… Tambahkan async/await
document.addEventListener('click', async function (e) {
  if (e.target.classList.contains('modal-detail-button')) {
    const imdbid = e.target.dataset.imdbid;
    
    const movieDetail = await getMovieDetail(imdbid);
    
    console.log(movieDetail); // âœ… Berhasil!
  }
});
```

**ğŸ“¤ Output:**
```javascript
{
  Title: "Avengers: Endgame",
  Year: "2019", 
  Director: "Anthony Russo, Joe Russo",
  Actors: "Robert Downey Jr., Chris Evans, Mark Ruffalo, Chris Hemsworth",
  Writer: "Christopher Markus, Stephen McFeely, Stan Lee",
  Plot: "After the devastating events of Avengers: Infinity War (2018)...",
  Poster: "https://m.media-amazon.com/images/M/MV5BMTc5MDE2ODcwNV5BMl5BanBnXkFtZTgwMzI2NzQ2NzM@._V1_SX300.jpg"
}
```

---

### <a id="langkah-14-membuat-function-updateuidetail"></a>Langkah 14: Membuat Function updateUIDetail()

**ğŸ¯ Tujuan:** Memisahkan logic update modal UI ke function terpisah

```javascript
// âœ… Panggil updateUIDetail di event listener
document.addEventListener('click', async function (e) {
  if (e.target.classList.contains('modal-detail-button')) {
    const imdbid = e.target.dataset.imdbid;
    
    const movieDetail = await getMovieDetail(imdbid);
    
    updateUIDetail(movieDetail); // âœ… Update modal
  }
});

// âœ… Buat function updateUIDetail
function updateUIDetail(m) {
  const movieDetail = showMovieDetail(m);
  
  const modalBody = document.querySelector('.modal-body');
  modalBody.innerHTML = movieDetail;
}
```

**ğŸ“¤ Output:** Modal berhasil menampilkan detail movie lengkap dengan poster, director, actors, plot, dll.

---

## <a id="kode-final-setelah-refactoring"></a>ğŸ¯ Kode Final (Setelah Refactoring)

```javascript
// âœ… KODE SETELAH REFACTORING - CLEAN & MAINTAINABLE

const searchButton = document.querySelector('.search-button');

// Event listener untuk search
searchButton.addEventListener('click', async function () {
  const inputKeyword = document.querySelector('.input-keyword');
  
  const movies = await getMovies(inputKeyword.value);
  updateUI(movies);
});

// Event binding untuk modal detail
document.addEventListener('click', async function (e) {
  if (e.target.classList.contains('modal-detail-button')) {
    const imdbid = e.target.dataset.imdbid;
    
    const movieDetail = await getMovieDetail(imdbid);
    updateUIDetail(movieDetail);
  }
});

// Function untuk mengambil data movies
function getMovies(keyword) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&s=' + keyword)
    .then((response) => response.json())
    .then((response) => response.Search);
}

// Function untuk update UI movies
function updateUI(movies) {
  let cards = '';
  movies.forEach((m) => (cards += showCards(m)));
  
  const movieContainer = document.querySelector('.movie-container');
  movieContainer.innerHTML = cards;
}

// Function untuk mengambil detail movie
function getMovieDetail(imdbid) {
  return fetch('http://www.omdbapi.com/?apikey=b2a155c4&i=' + imdbid)
    .then((response) => response.json())
    .then((m) => m);
}

// Function untuk update UI detail movie
function updateUIDetail(m) {
  const movieDetail = showMovieDetail(m);
  
  const modalBody = document.querySelector('.modal-body');
  modalBody.innerHTML = movieDetail;
}

// Helper function untuk membuat movie cards
function showCards(m) {
  return `<div class="col-md-4 my-5">
            <div class="card">
              <img src="${m.Poster}" class="card-img-top" />
              <div class="card-body">
                <h5 class="card-title">${m.Title}</h5>
                <h6 class="card-subtitle mb-2 text-body-secondary">${m.Year}</h6>
                <a href="#" class="btn btn-primary modal-detail-button" 
                   data-bs-toggle="modal" data-bs-target="#movieDetailModal" 
                   data-imdbid="${m.imdbID}">Show Details</a>
              </div>
            </div>
          </div>`;
}

// Helper function untuk membuat movie detail
function showMovieDetail(m) {
  return `<div class="container-fluid">
            <div class="row">
              <div class="col-md-3">
                <img src="${m.Poster}" alt="" class="img-fluid" />
              </div>
              <div class="col-md">
                <ul class="list-group">
                  <li class="list-group-item"><h4>${m.Title} (${m.Year})</h4></li>
                  <li class="list-group-item">
                    <strong>Director:</strong> ${m.Director}
                  </li>
                  <li class="list-group-item">
                    <strong>Actors:</strong> ${m.Actors}
                  </li>
                  <li class="list-group-item">
                    <strong>Writer:</strong> ${m.Writer}
                  </li>
                  <li class="list-group-item">
                    <strong>Plot:</strong><br/>${m.Plot}
                  </li>
                </ul>
              </div>
            </div>
          </div>`;
}
```

---

## <a id="perbandingan-before-vs-after"></a>ğŸ“Š Perbandingan Before vs After

| Aspek | Before (Kode Awal) | After (Setelah Refactoring) |
|-------|-------------------|----------------------------|
| **Readability** | âŒ Sulit dibaca (nested callbacks) | âœ… Mudah dibaca (async/await) |
| **Maintainability** | âŒ Sulit di-maintain | âœ… Mudah di-maintain |
| **Separation of Concerns** | âŒ Semua logic tercampur | âœ… Terpisah per function |
| **Error Handling** | âŒ Sulit handle error | âœ… Mudah handle error |
| **Testing** | âŒ Sulit untuk testing | âœ… Mudah untuk testing |
| **Event Binding** | âŒ Modal button tidak berfungsi | âœ… Event binding sempurna |

---

## <a id="kesimpulan"></a>ğŸ“ Kesimpulan

### ğŸ¯ Pelajaran Utama:

1. **Async/Await vs Promises**: 
   - `async/await` membuat kode lebih mudah dibaca dibanding `.then()` chains
   - Gunakan `async` untuk function dan `await` untuk menunggu Promise resolve

2. **Separation of Concerns**:
   - Pisahkan logic ke function-function kecil yang fokus
   - Setiap function punya tanggung jawab yang jelas

3. **Event Binding**:
   - Gunakan `document.addEventListener()` untuk elemen yang dibuat secara dinamis
   - Event delegation lebih efektif daripada direct binding

4. **Error Handling**:
   - Struktur kode yang bersih memudahkan implementasi error handling
   - Promise-based code lebih mudah untuk handle error

### ğŸš€ Next Steps:

- [ ] Implementasi error handling yang proper
- [ ] Tambah loading indicator
- [ ] Implementasi debouncing untuk search
- [ ] Cache hasil pencarian
- [ ] Tambah unit testing

---

**ğŸ“ Catatan:** Tutorial ini fokus pada refactoring teknik dan best practices dalam JavaScript modern. Pastikan untuk selalu melakukan testing setelah refactoring untuk memastikan functionality tetap berjalan dengan baik.

---

<div align="center">

### ğŸŒŸ Happy Coding! ğŸŒŸ

</div>
